{"ast":null,"code":"var _jsxFileName = \"C:\\\\dev\\\\ranalds.gift\\\\src\\\\components\\\\buildPage\\\\EditBuildPage.js\";\nimport React, { Component, useContext } from 'react';\nimport HeroTalents from '../heroTalents/HeroTalents';\nimport BuildList from '../buildList/BuildList';\nimport Inventory from '../inventory/Inventory';\nimport './EditBuildPage.css';\nimport HeroDetails from '../heroDetails/HeroDetails';\nimport { Tab, Tabs, TabList, TabPanel } from 'react-tabs';\nimport \"react-tabs/style/react-tabs.css\";\nimport BuildOptions from './BuildOptions';\nimport BuildSummary from './BuildSummary';\nimport { AppContext } from '../../stores/Store';\nimport HeroSelect from '../heroSelect/HeroSelect';\nimport { BuildPageContext } from '../../stores/BuildPageStore';\nimport { useParams, useRouteMatch } from 'react-router';\nimport { auth, db } from '../../utils/Firebase';\nimport * as Constants from '../../data/Constants';\nimport history from '../../utils/History';\nimport { PatchList } from '../../data/PatchList';\nimport { UserContext } from '../../stores/UserStore';\nimport { Link } from 'react-router-dom';\n\nfunction EditBuildPage() {\n  const [state, updateState] = useContext(AppContext);\n  const [userState, updateUserState] = useContext(UserContext);\n  const {\n    path\n  } = useRouteMatch();\n  var paths = path.split('/');\n  var currentPath = paths[paths.length - 1];\n  console.log('current path ' + currentPath);\n\n  if (currentPath === 'edit') {\n    if (state.readonly) {\n      updateState({\n        type: \"UPDATE_READONLY\",\n        payload: false\n      });\n    }\n  } else if (currentPath === 'view') {\n    if (!state.readonly) {\n      updateState({\n        type: \"UPDATE_READONLY\",\n        payload: true\n      });\n    }\n  } else if (currentPath === 'create') {\n    if (!state.createBuild) {\n      updateState({\n        type: \"UPDATE_CREATE_BUILD_STATE\",\n        payload: true\n      });\n    }\n  }\n\n  let params = useParams();\n  console.log(!userState.userId);\n  /*         if (!userState.userId || userState.userId == '') {\r\n              console.log('props.userId');\r\n              return <div className=\"error-message\">Error loading build for edit</div>;\r\n          }  */\n\n  console.log('params build id: ' + params.buildId); //console.log(PatchList[0]);\n\n  var root = document.getElementById('root');\n  root.dataset.pageName = 'editBuildPage';\n\n  if (params.buildId && state.buildId != params.buildId) {\n    loadBuild(params.buildId);\n  }\n\n  function loadBuild(buildId) {\n    console.log('loading build id ' + buildId);\n\n    if (state.buildId != buildId) {\n      state.buildId = buildId;\n    }\n\n    db.collection('builds').doc(buildId).get().then(build => {\n      if (!build.data()) {\n        console.log('No build found with ID ' + buildId); //history.push('/build/create');\n        //update state to indicate no build available in DB\n\n        return;\n      }\n\n      console.log('build loaded from db:');\n      console.log(build.data());\n      updateState({\n        type: 'INIT_STATE_FROM_DATA',\n        payload: build\n      });\n    }).catch(error => {\n      console.error('Error retrieving data from DB:', error);\n    });\n  }\n\n  function handleDescriptionChanged(e) {\n    updateState({\n      type: \"UPDATE_DESCRIPTION\",\n      payload: e.currentTarget.value\n    });\n  }\n\n  function handleNameChange(e) {\n    updateState({\n      type: \"UPDATE_NAME\",\n      payload: e.currentTarget.value\n    });\n  }\n\n  function saveBuild() {\n    if (!auth.currentUser) {\n      alert('Can\\'t save or create builds when not authenticated.');\n      return;\n    }\n\n    if (!state.dirty) {\n      console.log('Not saving build, no changes have been made.');\n      return;\n    }\n\n    console.log('saving build to database build id ' + state.buildId + ' for user id ' + auth.currentUser.uid);\n\n    if (state.buildId == 0) {\n      //creating new build then forward to build edit page\n      alert('creating new build');\n      db.collection('builds').add({\n        careerId: state.careerId,\n        meleeId: state.meleeId,\n        meleeProperty1: state.properties[Constants.MELEE_PROPERTY1_INDEX],\n        meleeProperty2: state.properties[Constants.MELEE_PROPERTY2_INDEX],\n        meleeTrait: state.traits[Constants.MELEE_TRAIT_INDEX],\n        rangeId: state.rangeId,\n        rangeProperty1: state.properties[Constants.RANGE_PROPERTY1_INDEX],\n        rangeProperty2: state.properties[Constants.RANGE_PROPERTY2_INDEX],\n        rangeTrait: state.traits[Constants.RANGE_TRAIT_INDEX],\n        necklaceProperty1: state.properties[Constants.NECKLACE_PROPERTY1_INDEX],\n        necklaceProperty2: state.properties[Constants.NECKLACE_PROPERTY2_INDEX],\n        necklaceTrait: state.traits[Constants.NECKLACE_TRAIT_INDEX],\n        charmProperty1: state.properties[Constants.CHARM_PROPERTY1_INDEX],\n        charmProperty2: state.properties[Constants.CHARM_PROPERTY2_INDEX],\n        charmTrait: state.traits[Constants.CHARM_TRAIT_INDEX],\n        trinketProperty1: state.properties[Constants.TRINKET_PROPERTY1_INDEX],\n        trinketProperty2: state.properties[Constants.TRINKET_PROPERTY2_INDEX],\n        trinketTrait: state.traits[Constants.TRINKET_TRAIT_INDEX],\n        talent1: state.talents[Constants.TALENT_TIER_1],\n        talent2: state.talents[Constants.TALENT_TIER_2],\n        talent3: state.talents[Constants.TALENT_TIER_3],\n        talent4: state.talents[Constants.TALENT_TIER_4],\n        talent5: state.talents[Constants.TALENT_TIER_5],\n        talent6: state.talents[Constants.TALENT_TIER_6],\n        name: state.name,\n        description: state.description,\n        difficulty: state.difficulty,\n        mission: state.mission,\n        potion: state.potion,\n        roles: state.roles,\n        likes: 0,\n        dateCreated: new Date(),\n        dateModified: new Date(),\n        userId: auth.currentUser.uid,\n        username: auth.currentUser.displayName,\n        videos: state.videos\n      }).then(docRef => {\n        console.log(\"Document written with ID: \", docRef.id);\n        history.push('/build/' + docRef.id + '/edit'); //redirect to build edit page here\n      }).catch(error => {\n        console.error(\"Error adding document: \", error);\n      });\n    } else {\n      console.log('updating build, current state:');\n      console.log(state);\n\n      if (state.userId != auth.currentUser.uid) {\n        alert('You can\\'t edit a build you didn\\'t create.');\n        return;\n      }\n\n      let buildDataRef = db.collection('builds').doc(state.buildId);\n      buildDataRef.update({\n        careerId: state.careerId,\n        meleeId: state.meleeId,\n        meleeProperty1: state.properties[Constants.MELEE_PROPERTY1_INDEX],\n        meleeProperty2: state.properties[Constants.MELEE_PROPERTY2_INDEX],\n        meleeTrait: state.traits[Constants.MELEE_TRAIT_INDEX],\n        rangeId: state.rangeId,\n        rangeProperty1: state.properties[Constants.RANGE_PROPERTY1_INDEX],\n        rangeProperty2: state.properties[Constants.RANGE_PROPERTY2_INDEX],\n        rangeTrait: state.traits[Constants.RANGE_TRAIT_INDEX],\n        necklaceProperty1: state.properties[Constants.NECKLACE_PROPERTY1_INDEX],\n        necklaceProperty2: state.properties[Constants.NECKLACE_PROPERTY2_INDEX],\n        necklaceTrait: state.traits[Constants.NECKLACE_TRAIT_INDEX],\n        charmProperty1: state.properties[Constants.CHARM_PROPERTY1_INDEX],\n        charmProperty2: state.properties[Constants.CHARM_PROPERTY2_INDEX],\n        charmTrait: state.traits[Constants.CHARM_TRAIT_INDEX],\n        trinketProperty1: state.properties[Constants.TRINKET_PROPERTY1_INDEX],\n        trinketProperty2: state.properties[Constants.TRINKET_PROPERTY2_INDEX],\n        trinketTrait: state.traits[Constants.TRINKET_TRAIT_INDEX],\n        talent1: state.talents[Constants.TALENT_TIER_1],\n        talent2: state.talents[Constants.TALENT_TIER_2],\n        talent3: state.talents[Constants.TALENT_TIER_3],\n        talent4: state.talents[Constants.TALENT_TIER_4],\n        talent5: state.talents[Constants.TALENT_TIER_5],\n        talent6: state.talents[Constants.TALENT_TIER_6],\n        name: state.name,\n        description: state.description,\n        difficulty: state.difficulty,\n        mission: state.mission,\n        potion: state.potion,\n        roles: state.roles,\n        likes: state.likes,\n        dateModified: new Date(),\n        userId: auth.currentUser.uid,\n        username: auth.currentUser.displayName,\n        videos: state.videos\n      }).then(() => {\n        console.log(\"Document updated with ID: \", state.buildId);\n        updateState({\n          type: \"UPDATE_DIRTY\",\n          payload: false\n        });\n        var buildSaveIndicator = document.getElementById('buildSaveIndicator');\n        buildSaveIndicator.classList.add('saved');\n        setTimeout(() => {\n          buildSaveIndicator.classList.remove('saved');\n        }, 4000);\n\n        if (buildSaveIndicator.classList.contains('saved')) {\n          buildSaveIndicator.style.animation = 'none'; //buildSaveIndicator.offsetHeight; /* trigger reflow */\n\n          buildSaveIndicator.style.animation = null;\n        } else {\n          buildSaveIndicator.classList.add('saved');\n        }\n      }).catch(error => {\n        console.error(\"Error updating document: \", error);\n      });\n      /* \r\n                      buildDataRef.get().then((buildData) => {\r\n                          alert('updating build');\r\n                          console.log(buildData.id);\r\n                          console.log(buildData.data());\r\n                          return;\r\n      \r\n                          buildData.update({\r\n          \r\n                          }).then((docRef) => {\r\n                              console.log(\"Document updated with ID: \", docRef.id);\r\n                          }).catch((error) => {\r\n                              console.error(\"Error updating document: \", error);\r\n                          });\r\n                      }).catch((error) => {\r\n                          console.error('Error getting document:', error);\r\n                      }); */\n    } //updateState({type: 'SAVE_BUILD', payload: '0'});\n\n  } //get build id param\n  //if empty, load nothing from DB\n  //if not empty, load build from DB and updatestate\n  //saving builds with /create/ url saves new db item and redirects to /buildId/edit page\n  //saving builds with /edit/ url just updates the record in the db\n\n\n  if (!state.isFromDb && !state.createBuild) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"edit-build-page\",\n      \"data-readonly\": state.readonly,\n      \"data-dirty\": state.dirty,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 287,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 288,\n        columnNumber: 21\n      }\n    }, \"No build found\"));\n  }\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"edit-build-page\",\n    \"data-readonly\": state.readonly,\n    \"data-dirty\": state.dirty,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 293,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    id: \"buildSaveIndicator\",\n    className: \"border-03 background-18\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 294,\n      columnNumber: 17\n    }\n  }, \"Build saved...\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"build-left-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 295,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"build-buttons-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 296,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    id: \"saveBuildButton\",\n    className: \"button-01 border-04\",\n    onClick: saveBuild.bind(this),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 297,\n      columnNumber: 25\n    }\n  }, \"Save Build\")), /*#__PURE__*/React.createElement(HeroSelect, {\n    careerId: state.careerId,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 299,\n      columnNumber: 21\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"build-main-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 301,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Tabs, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 302,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(TabList, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 303,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(Tab, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 304,\n      columnNumber: 29\n    }\n  }, \"Summary\"), /*#__PURE__*/React.createElement(Tab, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 305,\n      columnNumber: 29\n    }\n  }, \"Videos\"), /*#__PURE__*/React.createElement(Tab, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 306,\n      columnNumber: 29\n    }\n  }, \"Combos\")), /*#__PURE__*/React.createElement(TabPanel, {\n    className: \"build-summary-tab\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 308,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"build-details-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 309,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(HeroDetails, {\n    careerId: state.careerId,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 310,\n      columnNumber: 33\n    }\n  }), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    className: \"build-name-input border-02 background-18\",\n    placeholder: \"Name your build\",\n    value: state.name,\n    onChange: handleNameChange.bind(this),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 311,\n      columnNumber: 33\n    }\n  }), /*#__PURE__*/React.createElement(\"textarea\", {\n    className: \"input-build-description border-02 background-18\",\n    wrap: \"hard\",\n    placeholder: \"Describe your build\",\n    value: state.description,\n    onChange: handleDescriptionChanged.bind(this),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 312,\n      columnNumber: 33\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"build-information-container read-only-container border-16 background-24\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 313,\n      columnNumber: 33\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 314,\n      columnNumber: 37\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 314,\n      columnNumber: 42\n    }\n  }, \"Created by\"), /*#__PURE__*/React.createElement(Link, {\n    to: '/user/' + state.userId + '/view',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 314,\n      columnNumber: 65\n    }\n  }, state.username)), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 315,\n      columnNumber: 37\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 315,\n      columnNumber: 42\n    }\n  }, \"Patch\"), /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 315,\n      columnNumber: 60\n    }\n  }, state.patch)), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 316,\n      columnNumber: 37\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 316,\n      columnNumber: 42\n    }\n  }, \"Likes\"), /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 316,\n      columnNumber: 60\n    }\n  }, state.likes))), /*#__PURE__*/React.createElement(BuildOptions, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 318,\n      columnNumber: 33\n    }\n  })), /*#__PURE__*/React.createElement(BuildSummary, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 320,\n      columnNumber: 29\n    }\n  })), /*#__PURE__*/React.createElement(TabPanel, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 322,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"build-additional-info\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 323,\n      columnNumber: 29\n    }\n  })), /*#__PURE__*/React.createElement(TabPanel, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 326,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"hero-abilities\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 327,\n      columnNumber: 29\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"build-talents-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 331,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(HeroTalents, {\n    contextActionType: \"UPDATE_TALENTS\",\n    careerId: state.careerId,\n    talents: state.talents,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 332,\n      columnNumber: 25\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"build-right-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 335,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Inventory, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 336,\n      columnNumber: 21\n    }\n  })));\n}\n\nexport default EditBuildPage;","map":{"version":3,"sources":["C:/dev/ranalds.gift/src/components/buildPage/EditBuildPage.js"],"names":["React","Component","useContext","HeroTalents","BuildList","Inventory","HeroDetails","Tab","Tabs","TabList","TabPanel","BuildOptions","BuildSummary","AppContext","HeroSelect","BuildPageContext","useParams","useRouteMatch","auth","db","Constants","history","PatchList","UserContext","Link","EditBuildPage","state","updateState","userState","updateUserState","path","paths","split","currentPath","length","console","log","readonly","type","payload","createBuild","params","userId","buildId","root","document","getElementById","dataset","pageName","loadBuild","collection","doc","get","then","build","data","catch","error","handleDescriptionChanged","e","currentTarget","value","handleNameChange","saveBuild","currentUser","alert","dirty","uid","add","careerId","meleeId","meleeProperty1","properties","MELEE_PROPERTY1_INDEX","meleeProperty2","MELEE_PROPERTY2_INDEX","meleeTrait","traits","MELEE_TRAIT_INDEX","rangeId","rangeProperty1","RANGE_PROPERTY1_INDEX","rangeProperty2","RANGE_PROPERTY2_INDEX","rangeTrait","RANGE_TRAIT_INDEX","necklaceProperty1","NECKLACE_PROPERTY1_INDEX","necklaceProperty2","NECKLACE_PROPERTY2_INDEX","necklaceTrait","NECKLACE_TRAIT_INDEX","charmProperty1","CHARM_PROPERTY1_INDEX","charmProperty2","CHARM_PROPERTY2_INDEX","charmTrait","CHARM_TRAIT_INDEX","trinketProperty1","TRINKET_PROPERTY1_INDEX","trinketProperty2","TRINKET_PROPERTY2_INDEX","trinketTrait","TRINKET_TRAIT_INDEX","talent1","talents","TALENT_TIER_1","talent2","TALENT_TIER_2","talent3","TALENT_TIER_3","talent4","TALENT_TIER_4","talent5","TALENT_TIER_5","talent6","TALENT_TIER_6","name","description","difficulty","mission","potion","roles","likes","dateCreated","Date","dateModified","username","displayName","videos","docRef","id","push","buildDataRef","update","buildSaveIndicator","classList","setTimeout","remove","contains","style","animation","isFromDb","bind","patch"],"mappings":"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","sourcesContent":["import React, {Component, useContext} from 'react';\r\nimport HeroTalents from '../heroTalents/HeroTalents'\r\nimport BuildList from '../buildList/BuildList'\r\nimport Inventory from '../inventory/Inventory'\r\nimport './EditBuildPage.css';\r\nimport HeroDetails from '../heroDetails/HeroDetails';\r\nimport { Tab, Tabs, TabList, TabPanel } from 'react-tabs';\r\nimport \"react-tabs/style/react-tabs.css\";\r\nimport BuildOptions from './BuildOptions';\r\nimport BuildSummary from './BuildSummary';\r\nimport { AppContext } from '../../stores/Store';\r\nimport HeroSelect from '../heroSelect/HeroSelect';\r\nimport { BuildPageContext } from '../../stores/BuildPageStore';\r\nimport { useParams, useRouteMatch } from 'react-router';\r\nimport { auth, db } from '../../utils/Firebase';\r\nimport * as Constants from '../../data/Constants';\r\nimport history from '../../utils/History';\r\nimport { PatchList } from '../../data/PatchList';\r\nimport { UserContext } from '../../stores/UserStore';\r\nimport { Link } from 'react-router-dom';\r\n\r\nfunction EditBuildPage() {\r\n\r\n        const [state, updateState] = useContext(AppContext);\r\n        const [userState, updateUserState] = useContext(UserContext);\r\n\r\n        const { path } = useRouteMatch();\r\n        var paths = path.split('/');\r\n\r\n        var currentPath = paths[paths.length-1];\r\n        console.log('current path ' + currentPath);\r\n\r\n        if (currentPath === 'edit') {\r\n            if (state.readonly) {\r\n                updateState({\r\n                    type: \"UPDATE_READONLY\", \r\n                    payload: false\r\n                });\r\n            }\r\n        } \r\n        else if (currentPath === 'view') {\r\n            if (!state.readonly) {\r\n                updateState({\r\n                    type: \"UPDATE_READONLY\", \r\n                    payload: true\r\n                });\r\n            }\r\n        }\r\n        else if (currentPath === 'create') {\r\n            if (!state.createBuild) {\r\n                updateState({\r\n                    type: \"UPDATE_CREATE_BUILD_STATE\", \r\n                    payload: true\r\n                });\r\n            }\r\n        }\r\n\r\n        let params = useParams();\r\n\r\n        console.log(!userState.userId);\r\n\r\n/*         if (!userState.userId || userState.userId == '') {\r\n            console.log('props.userId');\r\n            return <div className=\"error-message\">Error loading build for edit</div>;\r\n        }  */\r\n    \r\n        console.log('params build id: ' + params.buildId);\r\n        //console.log(PatchList[0]);\r\n\r\n        var root = document.getElementById('root');\r\n        root.dataset.pageName = 'editBuildPage';\r\n\r\n        if (params.buildId && state.buildId != params.buildId) {\r\n            loadBuild(params.buildId);\r\n        }\r\n\r\n        function loadBuild(buildId) {\r\n            console.log('loading build id ' + buildId);\r\n            if (state.buildId != buildId) {\r\n                state.buildId = buildId;\r\n            }\r\n\r\n            db.collection('builds').doc(buildId).get().then((build) => {\r\n                if (!build.data()) {\r\n                    console.log('No build found with ID ' + buildId);\r\n                    //history.push('/build/create');\r\n\r\n                    //update state to indicate no build available in DB\r\n                    return;\r\n                }\r\n\r\n                console.log('build loaded from db:');\r\n                console.log(build.data());\r\n\r\n                updateState({\r\n                    type: 'INIT_STATE_FROM_DATA', \r\n                    payload: build\r\n                });\r\n            }).catch((error) => {\r\n                console.error('Error retrieving data from DB:', error);\r\n            });\r\n\r\n        }\r\n\r\n        function handleDescriptionChanged(e) {\r\n            updateState({\r\n                type: \"UPDATE_DESCRIPTION\", \r\n                payload: e.currentTarget.value\r\n            });\r\n        }\r\n\r\n        function handleNameChange(e) {\r\n            updateState({\r\n                type: \"UPDATE_NAME\", \r\n                payload: e.currentTarget.value\r\n            });\r\n        }\r\n\r\n        function saveBuild() {\r\n            if (!auth.currentUser) {\r\n                alert('Can\\'t save or create builds when not authenticated.');\r\n                return;\r\n            }\r\n\r\n            if (!state.dirty) {\r\n                console.log('Not saving build, no changes have been made.');\r\n                return;\r\n            }\r\n\r\n            console.log('saving build to database build id ' + state.buildId + ' for user id ' + auth.currentUser.uid);\r\n\r\n            if (state.buildId == 0) {\r\n                //creating new build then forward to build edit page\r\n\r\n                alert('creating new build');\r\n\r\n                db.collection('builds').add({\r\n                    careerId: state.careerId,\r\n                    meleeId: state.meleeId,\r\n                    meleeProperty1: state.properties[Constants.MELEE_PROPERTY1_INDEX],\r\n                    meleeProperty2:state.properties[Constants.MELEE_PROPERTY2_INDEX],\r\n                    meleeTrait: state.traits[Constants.MELEE_TRAIT_INDEX],\r\n                    rangeId: state.rangeId,\r\n                    rangeProperty1: state.properties[Constants.RANGE_PROPERTY1_INDEX],\r\n                    rangeProperty2: state.properties[Constants.RANGE_PROPERTY2_INDEX],\r\n                    rangeTrait: state.traits[Constants.RANGE_TRAIT_INDEX],\r\n                    necklaceProperty1: state.properties[Constants.NECKLACE_PROPERTY1_INDEX],\r\n                    necklaceProperty2: state.properties[Constants.NECKLACE_PROPERTY2_INDEX],\r\n                    necklaceTrait: state.traits[Constants.NECKLACE_TRAIT_INDEX],\r\n                    charmProperty1: state.properties[Constants.CHARM_PROPERTY1_INDEX],\r\n                    charmProperty2: state.properties[Constants.CHARM_PROPERTY2_INDEX],\r\n                    charmTrait: state.traits[Constants.CHARM_TRAIT_INDEX],\r\n                    trinketProperty1: state.properties[Constants.TRINKET_PROPERTY1_INDEX],\r\n                    trinketProperty2: state.properties[Constants.TRINKET_PROPERTY2_INDEX],\r\n                    trinketTrait: state.traits[Constants.TRINKET_TRAIT_INDEX],\r\n                    talent1: state.talents[Constants.TALENT_TIER_1],\r\n                    talent2: state.talents[Constants.TALENT_TIER_2],\r\n                    talent3: state.talents[Constants.TALENT_TIER_3],\r\n                    talent4: state.talents[Constants.TALENT_TIER_4],\r\n                    talent5: state.talents[Constants.TALENT_TIER_5],\r\n                    talent6: state.talents[Constants.TALENT_TIER_6],\r\n                    name: state.name,\r\n                    description: state.description,\r\n                    difficulty: state.difficulty,\r\n                    mission: state.mission,\r\n                    potion: state.potion,\r\n                    roles: state.roles,\r\n                    likes: 0,\r\n                    dateCreated: new Date(),\r\n                    dateModified: new Date(),\r\n                    userId: auth.currentUser.uid,\r\n                    username: auth.currentUser.displayName,\r\n                    videos: state.videos\r\n                }).then((docRef) => {\r\n                    console.log(\"Document written with ID: \", docRef.id);\r\n                    history.push('/build/' + docRef.id + '/edit');\r\n\r\n                    //redirect to build edit page here\r\n\r\n                }).catch((error) => {\r\n                    console.error(\"Error adding document: \", error);\r\n                });\r\n            }\r\n            else {\r\n\r\n                console.log('updating build, current state:');\r\n                console.log(state);\r\n\r\n                if (state.userId != auth.currentUser.uid) {\r\n                    alert('You can\\'t edit a build you didn\\'t create.');\r\n                    return;\r\n                }\r\n\r\n                let buildDataRef = db.collection('builds').doc(state.buildId);\r\n\r\n                buildDataRef.update({\r\n                    careerId: state.careerId,\r\n                    meleeId: state.meleeId,\r\n                    meleeProperty1: state.properties[Constants.MELEE_PROPERTY1_INDEX],\r\n                    meleeProperty2:state.properties[Constants.MELEE_PROPERTY2_INDEX],\r\n                    meleeTrait: state.traits[Constants.MELEE_TRAIT_INDEX],\r\n                    rangeId: state.rangeId,\r\n                    rangeProperty1: state.properties[Constants.RANGE_PROPERTY1_INDEX],\r\n                    rangeProperty2: state.properties[Constants.RANGE_PROPERTY2_INDEX],\r\n                    rangeTrait: state.traits[Constants.RANGE_TRAIT_INDEX],\r\n                    necklaceProperty1: state.properties[Constants.NECKLACE_PROPERTY1_INDEX],\r\n                    necklaceProperty2: state.properties[Constants.NECKLACE_PROPERTY2_INDEX],\r\n                    necklaceTrait: state.traits[Constants.NECKLACE_TRAIT_INDEX],\r\n                    charmProperty1: state.properties[Constants.CHARM_PROPERTY1_INDEX],\r\n                    charmProperty2: state.properties[Constants.CHARM_PROPERTY2_INDEX],\r\n                    charmTrait: state.traits[Constants.CHARM_TRAIT_INDEX],\r\n                    trinketProperty1: state.properties[Constants.TRINKET_PROPERTY1_INDEX],\r\n                    trinketProperty2: state.properties[Constants.TRINKET_PROPERTY2_INDEX],\r\n                    trinketTrait: state.traits[Constants.TRINKET_TRAIT_INDEX],\r\n                    talent1: state.talents[Constants.TALENT_TIER_1],\r\n                    talent2: state.talents[Constants.TALENT_TIER_2],\r\n                    talent3: state.talents[Constants.TALENT_TIER_3],\r\n                    talent4: state.talents[Constants.TALENT_TIER_4],\r\n                    talent5: state.talents[Constants.TALENT_TIER_5],\r\n                    talent6: state.talents[Constants.TALENT_TIER_6],\r\n                    name: state.name,\r\n                    description: state.description,\r\n                    difficulty: state.difficulty,\r\n                    mission: state.mission,\r\n                    potion: state.potion,\r\n                    roles: state.roles,\r\n                    likes: state.likes,\r\n                    dateModified: new Date(),\r\n                    userId: auth.currentUser.uid,\r\n                    username: auth.currentUser.displayName,\r\n                    videos: state.videos    \r\n                }).then(() => {\r\n                    console.log(\"Document updated with ID: \", state.buildId);\r\n                    \r\n                    updateState({\r\n                        type: \"UPDATE_DIRTY\", \r\n                        payload: false\r\n                    });\r\n\r\n                    var buildSaveIndicator = document.getElementById('buildSaveIndicator');\r\n                    buildSaveIndicator.classList.add('saved');\r\n                    setTimeout(() => { buildSaveIndicator.classList.remove('saved'); }, 4000);\r\n\r\n\r\n                    if (buildSaveIndicator.classList.contains('saved')) {\r\n                        buildSaveIndicator.style.animation = 'none';\r\n                        //buildSaveIndicator.offsetHeight; /* trigger reflow */\r\n                        buildSaveIndicator.style.animation = null; \r\n                    }\r\n                    else {\r\n                        buildSaveIndicator.classList.add('saved');\r\n                    }\r\n\r\n                }).catch((error) => {\r\n                    console.error(\"Error updating document: \", error);\r\n                });\r\n/* \r\n                buildDataRef.get().then((buildData) => {\r\n                    alert('updating build');\r\n                    console.log(buildData.id);\r\n                    console.log(buildData.data());\r\n                    return;\r\n\r\n                    buildData.update({\r\n    \r\n                    }).then((docRef) => {\r\n                        console.log(\"Document updated with ID: \", docRef.id);\r\n                    }).catch((error) => {\r\n                        console.error(\"Error updating document: \", error);\r\n                    });\r\n                }).catch((error) => {\r\n                    console.error('Error getting document:', error);\r\n                }); */\r\n            }\r\n            //updateState({type: 'SAVE_BUILD', payload: '0'});\r\n        }\r\n\r\n        //get build id param\r\n        //if empty, load nothing from DB\r\n        //if not empty, load build from DB and updatestate\r\n\r\n        //saving builds with /create/ url saves new db item and redirects to /buildId/edit page\r\n        //saving builds with /edit/ url just updates the record in the db\r\n\r\n        if (!state.isFromDb && !state.createBuild) {\r\n            return (\r\n                <div className=\"edit-build-page\" data-readonly={state.readonly} data-dirty={state.dirty}>\r\n                    <p>No build found</p>\r\n                </div>);\r\n        }\r\n\r\n        return (\r\n            <div className=\"edit-build-page\" data-readonly={state.readonly} data-dirty={state.dirty}>\r\n                <span id=\"buildSaveIndicator\" className=\"border-03 background-18\">Build saved...</span>\r\n                <div className=\"build-left-container\">\r\n                    <div className=\"build-buttons-container\">\r\n                        <span id=\"saveBuildButton\" className=\"button-01 border-04\" onClick={saveBuild.bind(this)}>Save Build</span>\r\n                    </div>                    \r\n                    <HeroSelect careerId={state.careerId}></HeroSelect>\r\n                </div>\r\n                <div className=\"build-main-container\">\r\n                    <Tabs>\r\n                        <TabList>\r\n                            <Tab>Summary</Tab>\r\n                            <Tab>Videos</Tab>\r\n                            <Tab>Combos</Tab>                        \r\n                        </TabList>\r\n                        <TabPanel className=\"build-summary-tab\">\r\n                            <div className=\"build-details-container\">\r\n                                <HeroDetails careerId={state.careerId}></HeroDetails>\r\n                                <input type=\"text\" className=\"build-name-input border-02 background-18\" placeholder=\"Name your build\" value={state.name} onChange={handleNameChange.bind(this)}></input>\r\n                                <textarea className=\"input-build-description border-02 background-18\" wrap=\"hard\" placeholder=\"Describe your build\" value={state.description} onChange={handleDescriptionChanged.bind(this)}></textarea>\r\n                                <div className=\"build-information-container read-only-container border-16 background-24\">\r\n                                    <div><span>Created by</span><Link to={'/user/' + state.userId + '/view'}>{state.username}</Link></div>\r\n                                    <div><span>Patch</span><span>{state.patch}</span></div>\r\n                                    <div><span>Likes</span><span>{state.likes}</span></div>\r\n                                </div>\r\n                                <BuildOptions></BuildOptions>\r\n                            </div>\r\n                            <BuildSummary></BuildSummary>\r\n                        </TabPanel>\r\n                        <TabPanel>\r\n                            <div className=\"build-additional-info\">\r\n                            </div>\r\n                        </TabPanel>\r\n                        <TabPanel>\r\n                            <div className=\"hero-abilities\">\r\n                            </div>                        \r\n                        </TabPanel>\r\n                    </Tabs>\r\n                    <div className=\"build-talents-container\">\r\n                        <HeroTalents contextActionType=\"UPDATE_TALENTS\" careerId={state.careerId} talents={state.talents}></HeroTalents>\r\n                    </div>\r\n                </div>\r\n                <div className=\"build-right-container\">\r\n                    <Inventory></Inventory>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\nexport default EditBuildPage;"]},"metadata":{},"sourceType":"module"}